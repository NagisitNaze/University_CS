     1                                 %line 1+1 procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 
    23                                 
    24                                 
    25                                 
    26                                 
    27                                 
    28                                 
    29                                 
    30                                 
    31                                 
    32                                 
    33                                 
    34                                 
    35                                 
    36                                 
    37                                 
    38                                 
    39                                 
    40                                 [section .data]
    41                                 
    42                                 
    43                                 
    44                                 
    45                                 LF equ 10
    46                                 NULL equ 0
    47                                 SPACE equ 0x20
    48                                 
    49                                 TRUE equ 1
    50                                 FALSE equ 0
    51                                 
    52                                 SUCCESS equ 0
    53                                 NOSUCCESS equ 1
    54                                 
    55                                 STDIN equ 0
    56                                 STDOUT equ 1
    57                                 STDERR equ 2
    58                                 
    59                                 SYS_read equ 0
    60                                 SYS_write equ 1
    61                                 SYS_open equ 2
    62                                 SYS_close equ 3
    63                                 SYS_fork equ 57
    64                                 SYS_exit equ 60
    65                                 SYS_creat equ 85
    66                                 SYS_time equ 201
    67                                 
    68                                 O_CREAT equ 0x40
    69                                 O_TRUNC equ 0x200
    70                                 O_APPEND equ 0x400
    71                                 
    72                                 O_RDONLY equ 000000
    73                                 O_WRONLY equ 000001
    74                                 O_RDWR equ 000002
    75                                 
    76                                 S_IRUSR equ 00400
    77                                 S_IWUSR equ 00200
    78                                 S_IXUSR equ 00100
    79                                 
    80                                 
    81                                 
    82                                 
    83 00000000 55736167653A202E2F-    usageMsg db "Usage: ./wc -w <searchWord> <-mc|-ic> -f <inputFile>"
    84 00000000 7763202D77203C7365-
    85 00000000 61726368576F72643E-
    86 00000000 203C2D6D637C2D6963-
    87 00000000 3E202D66203C696E70-
    88 00000000 757446696C653E     
    89 00000034 0A00                    db LF, NULL
    90                                 
    91 00000036 4572726F722C20696E-    errbadCLQ db "Error, invalid command line arguments."
    92 00000036 76616C696420636F6D-
    93 00000036 6D616E64206C696E65-
    94 00000036 20617267756D656E74-
    95 00000036 732E               
    96 0000005C 0A00                    db LF, NULL
    97                                 
    98 0000005E 4572726F722C20696E-    errWordSpec db "Error, invalid search word specifier."
    99 0000005E 76616C696420736561-
   100 0000005E 72636820776F726420-
   101 0000005E 737065636966696572-
   102 0000005E 2E                 
   103 00000083 0A00                    db LF, NULL
   104                                 
   105 00000085 4572726F722C207365-    errWordLength db "Error, search word length must be < 80 "
   106 00000085 6172636820776F7264-
   107 00000085 206C656E677468206D-
   108 00000085 757374206265203C20-
   109 00000085 383020             
   110 000000AC 636861726163746572-     db "characters."
   111 000000AC 732E               
   112 000000B7 0A00                    db LF, NULL
   113                                 
   114 000000B9 4572726F722C20696E-    errFileSpec db "Error, invalid input file specifier."
   115 000000B9 76616C696420696E70-
   116 000000B9 75742066696C652073-
   117 000000B9 70656369666965722E 
   118 000000DD 0A00                    db LF, NULL
   119                                 
   120 000000DF 4572726F722C20696E-    errCaseSpec db "Error, invalid match case specifier."
   121 000000DF 76616C6964206D6174-
   122 000000DF 636820636173652073-
   123 000000DF 70656369666965722E 
   124 00000103 0A00                    db LF, NULL
   125                                 
   126 00000105 4572726F722C206361-    errOpenIn db "Error, can not open input file."
   127 00000105 6E206E6F74206F7065-
   128 00000105 6E20696E7075742066-
   129 00000105 696C652E           
   130 00000124 0A00                    db LF, NULL
   131                                 
   132                                 
   133                                 
   134                                 
   135                                 MAXWORDLENGTH equ 80
   136                                 BUFFSIZE equ 250000
   137                                 
   138                                 
   139 00000126 90D0030000000000       bfMax dq BUFFSIZE
   140 0000012E 90D0030000000000       curr dq BUFFSIZE
   141 00000136 0000000000000000       wordIndex dq 0
   142                                 
   143 0000013E 00                     wasEOF db FALSE
   144                                 
   145 0000013F 4572726F7220726561-    errFileRead db "Error reading input file."
   146 0000013F 64696E6720696E7075-
   147 0000013F 742066696C652E     
   148 00000158 0A00                    db LF, NULL
   149                                 
   150                                 
   151                                 
   152                                 
   153 0000015A 466F756E64202700       resultStart db "Found '", NULL
   154 00000162 272000                 resultSpace db "' ", NULL
   155 00000165 2074696D65732E0A00     resultEnd db " times.", LF, NULL
   156                                 
   157                                 
   158                                 
   159                                 [section .bss]
   160                                 
   161 00000000 <gap>                  buff resb BUFFSIZE+1
   162 0003D091 <gap>                  tmpString resb MAXWORDLENGTH+1
   163                                 
   164                                 
   165                                 
   166                                 
   167                                 [section .text]
   168                                 
   169                                 
   170                                 
   171                                 
   172                                 
   173                                 
   174                                 
   175                                 
   176                                 
   177                                 
   178                                 
   179                                 
   180                                 
   181                                 
   182                                 
   183                                 
   184                                 
   185                                 
   186                                 [global checkParameters]
   187                                 checkParameters:
   188 00000000 53                      push rbx
   189 00000001 4154                    push r12
   190 00000003 4155                    push r13
   191                                 
   192 00000005 4D89C5                  mov r13, r8
   193 00000008 4989CC                  mov r12, rcx
   194 0000000B 4883FF01                cmp rdi, 1
   195 0000000F 7516                    jne noUsage
   196 00000011 48C7C7[00000000]        mov rdi, usageMsg
   197 00000018 E815030000              call printString
   198 0000001D 48C7C000000000          mov rax, FALSE
   199 00000024 E90E010000              jmp dn
   200                                  noUsage:
   201 00000029 4883FF06                cmp rdi, 6
   202 0000002D 7416                    je goodArgCount
   203 0000002F 48C7C7[00000000]        mov rdi, errbadCLQ
   204 00000036 E8F7020000              call printString
   205 0000003B 48C7C000000000          mov rax, FALSE
   206 00000042 E9F0000000              jmp dn
   207                                  goodArgCount:
   208 00000047 488B5E08                mov rbx, qword[rsi+8]
   209 0000004B 66813B2D77              cmp word[rbx], 0x772D
   210 00000050 7416                    je noErrorWordSpec
   211 00000052 48C7C7[00000000]        mov rdi, errWordSpec
   212 00000059 E8D4020000              call printString
   213 0000005E 48C7C000000000          mov rax, FALSE
   214 00000065 E9CD000000              jmp dn
   215                                  noErrorWordSpec:
   216 0000006A 488B5E10                mov rbx, qword[rsi+16]
   217 0000006E 4D31DB                  xor r11, r11
   218 00000071 4D31D2                  xor r10, r10
   219                                  length:
   220 00000074 468A1C13                mov r11b, byte[rbx+r10]
   221 00000078 4180FB00                cmp r11b, NULL
   222 0000007C 7409                    je endLength
   223 0000007E 44881A                  mov byte[rdx], r11b
   224 00000081 48FFC2                  inc rdx
   225 00000084 49FFC2                  inc r10
   226 00000087 EBE9                    jmp length
   227                                  endLength:
   228 00000089 C60200                  mov byte[rdx], NULL
   229 0000008C 4983FA50                cmp r10, MAXWORDLENGTH
   230 00000090 7216                    jb goodLength
   231 00000092 48C7C7[00000000]        mov rdi, errWordLength
   232 00000099 E894020000              call printString
   233 0000009E 48C7C000000000          mov rax, FALSE
   234 000000A5 E98D000000              jmp dn
   235                                  goodLength:
   236 000000AA 488B5E18                mov rbx, qword[rsi+24]
   237 000000AE 813B2D6D6300            cmp dword[rbx], 0x00636D2D
   238 000000B4 7505                    jne checkTwo
   239 000000B6 41C6042401              mov byte[r12], TRUE
   240 000000BB EB20                    jmp caseGood
   241                                  checkTwo:
   242 000000BD 813B2D696300            cmp dword[rbx], 0x0063692D
   243 000000C3 7418                    je caseGood
   244 000000C5 48C7C7[00000000]        mov rdi, errCaseSpec
   245 000000CC E861020000              call printString
   246 000000D1 48C7C000000000          mov rax, FALSE
   247 000000D8 EB60                    jmp dn
   248 000000DA 41C6042400              mov byte[r12], FALSE
   249                                  caseGood:
   250 000000DF 488B5E20                mov rbx, qword[rsi+32]
   251 000000E3 66813B2D66              cmp word[rbx], 0x662D
   252 000000E8 7413                    je goodFileSpec
   253 000000EA 48C7C7[00000000]        mov rdi, errFileSpec
   254 000000F1 E83C020000              call printString
   255 000000F6 48C7C000000000          mov rax, FALSE
   256 000000FD EB3B                    jmp dn
   257                                  goodFileSpec:
   258 000000FF 488B5E28                mov rbx, qword[rsi+40]
   259 00000103 48C7C002000000          mov rax, SYS_open
   260 0000010A 4889DF                  mov rdi, rbx
   261 0000010D 48C7C600000000          mov rsi, O_RDONLY
   262 00000114 0F05                    syscall
   263 00000116 4883F800                cmp rax, 0
   264 0000011A 7D13                    jge noError
   265 0000011C 48C7C7[00000000]        mov rdi, errOpenIn
   266 00000123 E80A020000              call printString
   267 00000128 48C7C000000000          mov rax, FALSE
   268 0000012F EB09                    jmp dn
   269                                  noError:
   270 00000131 41894500                mov dword[r13], eax
   271 00000135 48C7C001000000          mov rax, TRUE
   272                                  dn:
   273 0000013C 415D                    pop r13
   274 0000013E 415C                    pop r12
   275 00000140 5B                      pop rbx
   276 00000141 C3                      ret
   277                                 
   278                                 
   279                                 
   280                                 
   281                                 
   282                                 
   283                                 
   284                                 
   285                                 
   286                                 
   287                                 
   288                                 
   289                                 
   290                                 
   291                                 
   292                                 
   293                                 
   294                                 
   295                                 
   296                                 
   297                                 
   298                                 
   299                                 
   300                                 
   301                                 
   302                                 [global getWord]
   303                                 getWord:
   304 00000142 53                      push rbx
   305 00000143 4154                    push r12
   306 00000145 4155                    push r13
   307                                 
   308 00000147 4889FB                  mov rbx, rdi
   309                                 
   310 0000014A 4C8B1425[00000000]      mov r10, qword[bfMax]
   311 00000152 4C391425[00000000]      cmp qword[curr], r10
   312 0000015A 726F                    jb underBuffSize
   313 0000015C 803C25[00000000]01      cmp byte[wasEOF], TRUE
   314 00000164 750A                    jne notEOF
   315 00000166 48C7C000000000          mov rax, FALSE
   316 0000016D E9D6000000              jmp _dn
   317                                  notEOF:
   318 00000172 48C7C000000000          mov rax, SYS_read
   319 00000179 4889F7                  mov rdi, rsi
   320 0000017C 48C7C6[00000000]        mov rsi, buff
   321 00000183 48C7C290D00300          mov rdx, BUFFSIZE
   322 0000018A 0F05                    syscall
   323                                 
   324 0000018C 4883F800                cmp rax, 0
   325 00000190 7D16                    jge readFine
   326 00000192 48C7C0[00000000]        mov rax, errFileRead
   327 00000199 E894010000              call printString
   328 0000019E 48C7C000000000          mov rax, FALSE
   329 000001A5 E99E000000              jmp _dn
   330                                  readFine:
   331                                 
   332 000001AA 483D90D00300            cmp rax, BUFFSIZE
   333 000001B0 740E                    je notEof
   334 000001B2 C60425[00000000]01      mov byte[wasEOF], TRUE
   335 000001BA 48890425[00000000]      mov qword[bfMax], rax
   336                                  notEof
   337 000001C2 4D31D2                  xor r10, r10
   338 000001C5 4C891425[00000000]      mov qword[curr], r10
   339                                  underBuffSize:
   340                                 
   341 000001CD 4D31C9                  xor r9, r9
   342 000001D0 4D31DB                  xor r11, r11
   343 000001D3 4D31E4                  xor r12, r12
   344 000001D6 49C7C4[00000000]        mov r12, buff
   345 000001DD 4C8B2C25[00000000]      mov r13, qword[wordIndex]
   346 000001E5 4C8B0C25[00000000]      mov r9, qword[curr]
   347                                 
   348 000001ED 478A1C0C                mov r11b, byte[r12+r9]
   349 000001F1 4180FB20                cmp r11b, 0x20
   350 000001F5 750A                    jne wordCont
   351 000001F7 4D31ED                  xor r13, r13
   352 000001FA 4180FB10                cmp r11b, 0x10
   353 000001FE 7501                    jne wordCont
   354 00000200 4D31ED                  xor r13, r13
   355                                  wordCont:
   356                                 
   357                                  getNextWord:
   358 00000203 478A1C0C                mov r11b, byte[r12+r9]
   359 00000207 4180FB20                cmp r11b, 0x20
   360 0000020B 760A                    jbe endNextWord
   361 0000020D 46881C2B                mov byte[rbx+r13], r11b
   362 00000211 49FFC5                  inc r13
   363 00000214 49FFC1                  inc r9
   364 00000217 EBE8                    jmp getNextWord
   365                                  endNextWord:
   366                                 
   367 00000219 42C6042B00              mov byte[rbx+r13], NULL
   368                                  ignoreSpaces:
   369 0000021E 478A1C0C                mov r11b, byte[r12+r9]
   370 00000222 4180FB20                cmp r11b, 0x20
   371 00000226 770C                    ja endIgnoreSpaces
   372 00000228 4180FB00                cmp r11b, 0x00
   373 0000022C 7406                    je endIgnoreSpaces
   374 0000022E 4D31ED                  xor r13, r13
   375 00000231 49FFC1                  inc r9
   376 00000234 EBE6                    jmp ignoreSpaces
   377                                  endIgnoreSpaces:
   378                                 
   379 00000236 4C890C25[00000000]      mov qword[curr], r9
   380 0000023E 4C892C25[00000000]      mov qword[wordIndex], r13
   381 00000246 48C7C001000000          mov rax, TRUE
   382                                  _dn:
   383 0000024D 415D                    pop r13
   384 0000024F 415C                    pop r12
   385 00000251 5B                      pop rbx
   386 00000252 C3                      ret
   387                                 
   388                                 
   389                                 
   390                                 
   391                                 
   392                                 
   393                                 
   394                                 
   395                                 
   396                                 
   397                                 
   398                                 
   399                                 
   400                                 
   401                                 
   402                                 [global checkWord]
   403                                 checkWord:
   404 00000253 53                      push rbx
   405                                 
   406 00000254 4D31DB                  xor r11, r11
   407 00000257 4D31E4                  xor r12, r12
   408                                  wordLoop:
   409 0000025A 448A1F                  mov r11b, byte[rdi]
   410 0000025D 448A26                  mov r12b, byte[rsi]
   411 00000260 4883FA01                cmp rdx, TRUE
   412 00000264 741E                    je contCompare
   413 00000266 4180FB41                cmp r11b, 0x41
   414 0000026A 7208                    jb skipSearchWrd
   415 0000026C 4180FB5A                cmp r11b, 0x5A
   416 00000270 7702                    ja skipSearchWrd
   417 00000272 4180C320                add r11b, 0x20
   418                                  skipSearchWrd:
   419 00000276 4180FC41                cmp r12b, 0x41
   420 0000027A 7208                    jb skipCurrentWrd
   421 0000027C 4180FC5A                cmp r12b, 0x5A
   422 00000280 7702                    ja skipCurrentWrd
   423 00000282 4180C420                add r12b, 0x20
   424                                  skipCurrentWrd:
   425                                  contCompare:
   426 00000286 4538E3                  cmp r11b, r12b
   427 00000289 7512                    jne endWordLoop
   428 0000028B 4180FB00                cmp r11b, NULL
   429 0000028F 7406                    je endWordLoopInc
   430 00000291 48FFC7                  inc rdi
   431 00000294 48FFC6                  inc rsi
   432 00000297 EBBF                    jmp wordLoop
   433                                  endWordLoopInc:
   434 00000299 8B19                    mov ebx, dword[rcx]
   435 0000029B FFC3                    inc ebx
   436 0000029D 8919                    mov dword[rcx], ebx
   437                                  endWordLoop:
   438                                 
   439 0000029F 5B                      pop rbx
   440 000002A0 C3                      ret
   441                                 
   442                                 
   443                                 
   444                                 
   445                                 
   446                                 
   447                                 
   448                                 
   449                                 
   450                                 
   451                                 
   452                                 
   453                                 
   454                                 
   455                                 
   456                                 [global displayResults]
   457                                 displayResults:
   458 000002A1 53                      push rbx
   459 000002A2 4154                    push r12
   460                                 
   461 000002A4 4989F4                  mov r12, rsi
   462 000002A7 4889FB                  mov rbx, rdi
   463                                 
   464 000002AA 48C7C7[00000000]        mov rdi, resultStart
   465 000002B1 E87C000000              call printString
   466 000002B6 4889DF                  mov rdi, rbx
   467 000002B9 E874000000              call printString
   468 000002BE 48C7C7[00000000]        mov rdi, resultSpace
   469 000002C5 E868000000              call printString
   470                                 
   471 000002CA 4489E0                  mov eax, r12d
   472 000002CD 48C7C606000000          mov rsi, 6
   473 000002D4 49C7C230000000          mov r10, 0x30
   474 000002DB 48C7C100000000          mov rcx, 0
   475 000002E2 49C7C1[00000000]        mov r9, tmpString
   476                                  int2senaryloop1:
   477 000002E9 BA00000000              mov edx, 0
   478 000002EE F7F6                    div esi
   479 000002F0 48FFC1                  inc rcx
   480 000002F3 83F800                  cmp eax, 0
   481 000002F6 75EF                    jne int2senaryloop1
   482 000002F8 4489E0                  mov eax, r12d
   483 000002FB 4901C9                  add r9, rcx
   484 000002FE 41C60100                mov byte[r9], NULL
   485 00000302 49FFC9                  dec r9
   486                                  int2senaryloop2:
   487 00000305 BA00000000              mov edx, 0
   488 0000030A F7F6                    div esi
   489 0000030C 4401D2                  add edx, r10d
   490 0000030F 418811                  mov byte[r9], dl
   491 00000312 49FFC9                  dec r9
   492 00000315 83F800                  cmp eax, 0
   493 00000318 75E9                    jne int2senaryloop2
   494                                 
   495 0000031A 4831FF                  xor rdi, rdi
   496 0000031D BF[00000000]            mov edi, tmpString
   497 00000322 E80B000000              call printString
   498                                 
   499 00000327 48C7C7[00000000]        mov rdi, resultEnd
   500 0000032E E8FFFFFFFF              call printString
   501                                 
   502 00000333 415C                    pop r12
   503 00000335 5B                      pop rbx
   504 00000336 C3                      ret
   505                                 
   506                                 
   507                                 
   508                                 
   509                                 
   510                                 
   511                                 
   512                                 
   513                                 
   514                                 
   515                                 
   516                                 
   517                                 
   518                                 
   519                                 
   520                                 
   521                                 
   522                                 
   523                                 [global printString]
   524                                 printString:
   525                                 
   526                                 
   527                                 
   528                                 
   529 00000337 48C7C200000000          mov rdx, 0
   530                                 strCountLoop:
   531 0000033E 803C1700                cmp byte [rdi+rdx], NULL
   532 00000342 7403                    je strCountLoopDone
   533 00000344 48FFC2                  inc rdx
   534 00000347 EBF3                    jmp strCountLoop
   535                                 strCountLoopDone:
   536 00000349 4883FA00                cmp rdx, 0
   537 0000034D 7411                    je printStringDone
   538                                 
   539                                 
   540                                 
   541                                 
   542 0000034F 48C7C001000000          mov rax, SYS_write
   543 00000356 4889FE                  mov rsi, rdi
   544 00000359 48C7C701000000          mov rdi, STDOUT
   545                                 
   546 00000360 0F05                    syscall
   547                                 
   548                                 
   549                                 
   550                                 
   551                                 printStringDone:
   552 00000362 C3                      ret
   553                                 
   554                                 
   555                                 
   556                                 
